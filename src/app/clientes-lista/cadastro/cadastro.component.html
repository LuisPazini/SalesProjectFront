<ng-template #formulario let-modal class="vw-50">

    <div class="moda-header">
        <h1 class="modal-title display-4 text-muted text-center">Cadastro de Cliente</h1>
    </div>

    <div class="modal-body w-100">
        <form class="needs-validation" [formGroup]="cliente" (ngSubmit)="salvar(cliente.getRawValue())" novalidate>
            
            <div class="form-row align-items-baseline">
                <div class="form-group col-md-5">
                    <label class="col-form-label" for="cnpj">CNPJ*: </label>
                    <input class="form-control" 
                    name="cnpj" type="text" (change)="consultarCNPJ()" formControlName="cnpj" mask="00.000.000/0000-00"
                    [class.is-invalid]="cliente.get('cnpj').touched && cliente.get('cnpj').invalid" >
                    <div *ngIf="cliente.get('cnpj').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('cnpj').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
                <div class="form-group col">
                    <label class="col-form-label" for="nome">Nome Cliente*:</label>
                    <input class="form-control" name="nome" type="text" formControlName="companyName"
                    [class.is-invalid]="cliente.get('companyName').touched && cliente.get('companyName').invalid">
                    <div *ngIf="cliente.get('companyName').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('companyName').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
            </div>
            <div class="form-row align-items-baseline">
                <div class="form-group col-md-3">
                    <label class="col-form-label" for="data-abertura">Data Abertura*: </label>
                    <input class="form-control" name="data-abertura" type="date" formControlName="opening"
                    [class.is-invalid]="cliente.get('opening').touched && cliente.get('opening').invalid">
                    <div *ngIf="cliente.get('opening').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('opening').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
                <div class="form-group col-md-4">
                    <label class="col-form-label" for="telefone">Telefone*: </label>
                    <input class="form-control" name="telefone" type="tel" formControlName="phone" 
                    mask="(00) 0000-0000 || (00) 0 0000-0000"
                    [class.is-invalid]="cliente.get('phone').touched && cliente.get('phone').invalid">
                    <div *ngIf="cliente.get('phone').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('phone').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
                <div class="form-group col-md-5">
                    <label class="col-form-label" for="email">E-mail*: </label>
                    <input class="form-control" name="email" type="email" formControlName="email"
                    [class.is-invalid]="cliente.get('email').touched && cliente.get('email').invalid">
                    <div *ngIf="cliente.get('email').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('email').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
            </div>
            <div class="form-row align-items-baseline">
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="registro-estadual">Inscrição Estadual*: </label>
                    <input class="form-control" name="registro-estadual" type="text" formControlName="stateRegistration"
                    [class.is-invalid]="cliente.get('stateRegistration').touched && cliente.get('stateRegistration').invalid">
                    <div *ngIf="cliente.get('stateRegistration').errors" class="invalid-feedback">
                        <div *ngIf="cliente.get('stateRegistration').errors.required" >Este campo é obrigatório</div>
                    </div>
                </div>
                <div class="form-group col-md-6">
                    <label class="col-form-label" for="registro-municipal">Inscrição Municipal: </label>
                    <input class="form-control" name="registro-municipal" type="text" formControlName="municipalRegistration">
                </div>
            </div>

            <div class="form-group">
                <label for="enderecos">Endereços: </label>

                <div formArrayName="adresses"
                *ngFor="let endereco of addresses.controls; let i=index" name="enderecos">
                    <div [formGroupName]="i" class="border border-secondary rounded-top px-2 my-2 align-items-center justify-content-center">
                        <label class="col text-center" for="endereco">
                            <span class="badge badge-warning">Endereço {{ i+1 }}:</span>
                        </label>
                        <div class="form-row">
                            <div class="col-md-10" [class.col-md-12]="!edicao">
                                <div class="form-row">
                                    <div class="form-group col-md-8">
                                        <label class="col-form-label" for="descricao">Descrição: </label>
                                        <input class="form-control" name="descricao" type="text"
                                        formControlName="description">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label class="col-form-label" for="cep">CEP: </label>
                                        <input class="form-control" name="cep" type="text" mask="00.000-000"
                                        (change)="consultarEndereco(i)" 
                                        formControlName="zipCode">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-3">
                                        <label class="col-form-label" for="tipo">Tipo: </label>
                                        <ng-select name="tipo" formControlName="type">
                                            <ng-option *ngFor="let tipoEndereco of tiposEndereco" [value]="tipoEndereco.id">
                                                {{ tipoEndereco.tipo }}
                                            </ng-option>
                                        </ng-select>
                                    </div>
                                    <div class="form-group col-md-7">
                                        <label class="col-form-label" for="rua">Rua: </label>
                                        <input class="form-control" name="rua" type="text" formControlName="street">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label class="col-form-label" for="numero">Número: </label>
                                        <input class="form-control" name="numero" type="number" formControlName="number">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-5">
                                        <label class="col-form-label" for="bairro">Bairro: </label>
                                        <input class="form-control" name="bairro" type="text" formControlName="neighborhood">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label class="col-form-label" for="cidade">Cidade: </label>
                                        <input class="form-control" name="cidade" type="text" formControlName="city">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label class="col-form-label" for="estado">Estado: </label>
                                        <input class="form-control" name="estado" type="text" formControlName="state">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1 text-center align-self-center">
                                <button class="btn btn-danger" type="button" 
                                (click)="removerEndereco(i)" *ngIf="edicao" >
                                    Remover Endereço
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row justify-content-center">
                    <button class="btn btn-primary" type="button" 
                    (click)="adicionarEndereco()" *ngIf="edicao">
                        <span>+ </span>Novo Endereco
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="enderecos">Contatos: </label>

                <p *ngIf="contacts.length == 0" class="col text-center my-5">Nenhum contato cadastrado</p>
                <div formArrayName="contacts"
                *ngFor="let contato of contacts.controls; let i=index" name="contatos">
                    <div [formGroupName]="i" class="border border-secondary rounded-top px-2 my-2 align-items-center justify-content-center">
                        <label class="col text-center" for="endereco">
                            <span class="badge badge-warning">Contato {{ i+1 }}:</span>
                        </label>
                        <div class="form-row">
                            <div class="col-md-10" [class.col-md-12]="!edicao">
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="col-form-label" for="nome">Nome: </label>
                                        <input class="form-control" name="nome" type="text"
                                        formControlName="firstName">
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="col-form-label" for="sobrenome">Sobrenome: </label>
                                        <input class="form-control" name="sobrenome" type="text"
                                        formControlName="lastName">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label class="col-form-label" for="email">E-mail: </label>
                                        <input class="form-control" name="email" type="email" formControlName="email">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label class="col-form-label" for="whatsapp">WhatsApp: </label>
                                        <input class="form-control" name="whatsapp" type="tel"  mask="(00) 0000-0000 || (00) 0 0000-0000"
                                         formControlName="whatsApp">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label class="col-form-label" for="telefone">Telefone: </label>
                                        <input class="form-control" name="telefone" type="tel"  mask="(00) 0000-0000 || (00) 0 0000-0000"
                                        formControlName="phone">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-1 text-center align-self-center">
                                <button class="btn btn-danger" type="button" 
                                (click)="removerContato(i)" *ngIf="edicao">
                                    Remover Contato
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-row justify-content-center">
                    <button class="btn btn-primary" type="button" 
                    (click)="adicionarContato()" *ngIf="edicao">
                        <span>+ </span>Novo Contato
                    </button>
                </div>
            </div>

            <div class="modal-footer mt-2 justify-content-center">
                <button class="btn btn-success" type="submit"
                [disabled]="!edicao">
                    Salvar
                </button>
                <button class="btn btn-danger" type="reset" (click)="remover(cliente.getRawValue())"
                [disabled]="!edicao || !cliente.get('id').value">
                    Remover
                </button>
                <button class="btn btn-warning" type="reset"
                [disabled]="!cliente.dirty || cliente.get('cnpj').disabled">
                    Limpar
                </button>
                <button class="btn btn-secondary" type="reset" (click)="modal.dismiss()">Cancelar</button>
            </div>
        </form>
    </div>
</ng-template>