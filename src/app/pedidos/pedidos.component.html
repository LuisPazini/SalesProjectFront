<div class="form-row justify-content-center align-items-center mx-4 mt-5 mb-4">
    <div class="form-row col-md-8 align-items-center justify-content-center mt-3 text-center">
        <label class="mx-2" for="de">Período: </label>
        <div class="form-group col-sm-3">
            <input class="form-control text-center" name="de" type="date" [(ngModel)]="dataInicial" 
            [value]="dataInicial | date: 'yyyy-MM-dd'">
        </div>
        <label class="mx-2" for="a">até</label>
        <div class="form-group col-sm-3">
            <input class="form-control text-center" name="a" type="date" [(ngModel)]="dataFinal" 
            [value]="dataFinal | date: 'yyyy-MM-dd'">
        </div>

        <div class="form-group col-md-8 mt-2">
            <ng-select class="text-center" [(ngModel)]="status" (change)="popularListaPedidos()" placeholder="Selecione um Status...">
                <ng-option *ngFor="let status of statuses" [value]="status.id">
                    {{ status.nome }}
                </ng-option>
            </ng-select>
        </div>

        <div class="form-group col-md-8 mt-2">
            <ng-select class="text-center" [disabled]="isUserCustomer()" [(ngModel)]="cliente" (change)="popularListaPedidos()" placeholder="Selecione um Cliente...">
                <ng-option *ngFor="let cliente of clientes" [value]="cliente">
                    {{ cliente.companyName }}
                </ng-option>
            </ng-select>
        </div>
    </div>

    <div class="col-md-3 justify-content-center text-center">
        <button class="btn btn-secondary" (click)="popularListaPedidos()">Pesquisar</button>
        <button class="btn btn-primary ml-1" (click)="formulario.open(null, true)"><span>+</span> Novo </button>
    </div>
</div>

<app-cadastro #formulario (cadastrado)="popularListaPedidos()"></app-cadastro>

<table class="table table-hover">
    <thead class="text-center thead-cinza">
        <tr>
            <th>Data de Emissão</th>
            <th>Data de Entrega</th>
            <th>Cliente</th>
            <th>Qtde Itens</th>
            <th>Status</th>
            <th>Observação</th>
            <th></th>
        </tr>
    </thead>
    <tbody *ngIf="pedidos.length" class="text-center">
        <tr *ngFor="let pedido of pedidos | slice: (page-1) * pageSize : page * pageSize">
            <td>{{ pedido.postingDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ pedido.deliveryDate | date: 'dd/MM/yyyy' }}</td>
            <td>{{ pedido.customerId | cliente: clientes }}</td>
            <td>{{ pedido.orderLines.length }}</td>
            <td>
                <span class="badge"
                [class.badge-warning]="pedido.status == 1"
                [class.badge-success]="pedido.status == 2"
                [class.badge-light]="pedido.status == 3"
                [class.badge-secondary]="pedido.status == 4">
                    {{ pedido.status | statusPedido }}
                </span>
            </td>
            <td>{{ pedido.observation }}</td>
            <td>
                <button class="btn btn-info" (click)="formulario.open(pedido)">Visualizar</button>
                <button class="btn btn-warning"
                   [disabled]="pedido.status == 4 || isUserCustomer()" 
                   (click)="formulario.open(pedido, true)">Editar</button>
            </td>
        </tr>
        <ngb-pagination *ngIf="pedidos.length" [(page)]="page" [pageSize]="pageSize" [collectionSize]="pedidos.length">
        </ngb-pagination>
    </tbody>
</table>

<div class="cards container-fluid text-center"
*ngIf="pedidos.length">
    <div class="card mx-3 my-2" 
    *ngFor="let pedido of pedidos | slice: (pageMobile-1) * pageSizeMobile : pageMobile * pageSizeMobile">
        <div class="card-header text-center">{{ pedido.customerId | cliente: clientes }}</div>
        <div class="card-body card-text px-5">
            <p class="font-weight-bold mb-0">Data de Emissão: </p><p>{{ pedido.postingDate | date: 'dd/MM/yyyy' }}</p>
            <p class="font-weight-bold mb-0">Data de Entrega: </p><p>{{ pedido.deliveryDate | date: 'dd/MM/yyyy' }}</p>
            <p class="font-weight-bold mb-0">Qtde Itens: </p><p>{{ pedido.orderLines.length | number }}</p>
            <p class="font-weight-bold mb-0">Status: </p>
            <p class="badge"
            [class.badge-warning]="pedido.status == 1"
            [class.badge-success]="pedido.status == 2"
            [class.badge-info]="pedido.status == 3"
            [class.badge-secondary]="pedido.status == 4">
                {{ pedido.status | statusPedido }}
            </p>
            <p class="font-weight-bold mb-0">Observação: </p><p>{{ pedido.observation || '-' }}</p>
        </div>
        <div class="card-footer align-content-around">
            <button class="btn btn-info" (click)="formulario.open(pedido)" >Visualizar</button>
            <button class="btn btn-warning" [disabled]="pedido.status == 4 || isUserCustomer()" 
                (click)="formulario.open(pedido, true)" >Editar</button>
        </div>
    </div>
    <div class="w-100 justify-content-center text-center">
        <ngb-pagination class="justify-content-center"
        *ngIf="pedidos.length" [(page)]="page" [pageSize]="pageSize" [collectionSize]="pedidos.length">
        </ngb-pagination>
    </div>
</div>

<p *ngIf="!pedidos.length" class="text-center mt-5">{{ notFoundText }}</p>